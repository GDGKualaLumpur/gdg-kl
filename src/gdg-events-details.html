<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/paper-spinner/paper-spinner-lite.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="shared-styles.html">

<dom-module id="gdg-events-details">
    <template>
        <style include="shared-styles">
            :host {
                display: block;
            }

            a {
                color: #4285F4;
            }

            .container {
                max-width: 1000px;
            }

            paper-icon-button {
                margin-bottom: 12px;
                color: rgba(0, 0, 0, .5);
            }

            .card {
                width: 100%;
                background: white;
                margin: 0 auto;
                -webkit-box-shadow: 0 1px 3px 0 rgba(0, 0, 0, .2), 0 1px 1px 0 rgba(0, 0, 0, .14), 0 2px 1px -1px rgba(0, 0, 0, .12);
                box-shadow: 0 1px 3px 0 rgba(0, 0, 0, .2), 0 1px 1px 0 rgba(0, 0, 0, .14), 0 2px 1px -1px rgba(0, 0, 0, .12)
            }

            .event .cover {
                position: relative;
                border-bottom: 1px solid rgba(0, 0, 0, .12);
                height: 350px;
                width: 100%;
                background-position: 50% 50%;
                background-size: cover;
            }

            .event .cover:before {
                content: '';
                position: absolute;
                top: 0;
                right: 0;
                bottom: 0;
                left: 0;
                background-image: -webkit-gradient(linear, left top, left bottom, from(rgba(0, 0, 0, .75)), to(transparent));
                background-image: -webkit-linear-gradient(top, rgba(0, 0, 0, .75), transparent);
                background-image: -o-linear-gradient(top, rgba(0, 0, 0, .75), transparent);
                background-image: linear-gradient(to bottom, rgba(0, 0, 0, .75), transparent);
                opacity: 0;
                height: 92px;
            }

            .event .loading {
                min-height: 400px;
                display: -webkit-box;
                display: -ms-flexbox;
                display: flex;
                margin-top: 36px;
                -webkit-box-align: center;
                -ms-flex-align: center;
                align-items: center;
                -webkit-box-orient: vertical;
                -webkit-box-direction: normal;
                -ms-flex-direction: column;
                flex-direction: column;
                text-align: center;
                color: #757575
            }

            .event .loading iron-icon {
                width: 30px;
                height: 30px;
                margin: 12px 0 24px 0;
            }

            .event .loading h2 {
                font-weight: 400;
                font-size: 20px;
                margin-bottom: 8px;
            }

            .event .loading p {
                font-size: 13px;
            }

            .event .content {
                display: -webkit-box;
                display: -ms-flexbox;
                display: flex;
            }

            .event .details {
                width: 100%;
                -webkit-box-orient: vertical;
                -webkit-box-direction: normal;
                -ms-flex-direction: column;
                flex-direction: column;
                display: -webkit-box;
                display: -ms-flexbox;
                display: flex;
                -webkit-box-flex: 1;
                -ms-flex: 1 1 60%;
                flex: 1 1 60%;
                padding: 24px 42px 48px 24px;
            }

            .event .details h3 {
                color: rgba(0, 0, 0, .95);
                font-weight: 400;
                margin: 0 0 4px 0;
                font-size: 26px;
            }

            .event .details h4 {
                margin: 0;
                font-size: 14px;
                font-weight: 400;
                color: rgba(0, 0, 0, .6);
            }

            .event .details p {
                white-space: pre-wrap;
                max-width: 600px;
                font-size: 15px;
                color: rgba(0, 0, 0, .85);
                margin-bottom: 0;
                line-height: 24px;
            }

            .event .info {
                -webkit-box-sizing: border-box;
                box-sizing: border-box;
                min-width: 350px;
                margin: -48px 32px 24px 0;
                -webkit-box-flex: 1;
                -ms-flex: 1;
                flex: 1;
            }

            .event .info .card {
                min-height: 200px;
                padding: 24px;
                -webkit-box-sizing: border-box;
                box-sizing: border-box;
                position: relative;
            }

            .chip {
                display: inline-block;
                margin: 8px 0 16px 0;
                font-size: 13px;
                padding: 1px 18px;
                text-transform: capitalize;
                border-radius: 100px;
                border: 1px solid rgba(0, 0, 0, .4);
                color: rgba(0, 0, 0, .8);
                text-align: center;
                cursor: pointer;
                -webkit-transition: 80ms all linear;
                -o-transition: 80ms all linear;
                transition: 80ms all linear;
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }

            .info .card .button,
            .button {
                text-decoration: none;
                cursor: pointer;
                background: #4285F4;
                color: white;
                text-transform: uppercase;
                display: -webkit-box;
                display: -ms-flexbox;
                display: flex;
                border-radius: 4px;
                height: 40px;
                -webkit-box-pack: center;
                -ms-flex-pack: center;
                justify-content: center;
                -webkit-box-align: center;
                -ms-flex-align: center;
                align-items: center;
                font-size: 14px;
                margin-top: 32px;
                -webkit-box-shadow: 0 2px 5px 0 rgba(0, 0, 0, .26);
                box-shadow: 0 2px 5px 0 rgba(0, 0, 0, .26);
            }

            .info .item {
                font-weight: 500;
                font-size: 14px;
                display: -webkit-box;
                display: -ms-flexbox;
                display: flex;
                -webkit-box-orient: horizontal;
                -webkit-box-direction: normal;
                -ms-flex-direction: row;
                flex-direction: row;
            }

            .info .item .row {
                -webkit-box-orient: vertical;
                -webkit-box-direction: normal;
                -ms-flex-direction: column;
                flex-direction: column;
                width: auto;
                -webkit-box-flex: 1;
                -ms-flex: 1;
                flex: 1;
                -ms-flex-wrap: nowrap;
                flex-wrap: nowrap;
            }

            .info .item .row.action {
                color: #4285F4;
                -webkit-box-flex: 0;
                -ms-flex: 0;
                flex: 0;
                margin-left: 16px;
                -webkit-box-pack: center;
                -ms-flex-pack: center;
                justify-content: center;
                text-transform: uppercase;
                -webkit-box-align: end;
                -ms-flex-align: end;
                align-items: flex-end;
            }

            .info .item .row.action a {
                text-decoration: none;
            }

            .info .item .title {
                margin-bottom: 2px;
                color: rgba(0, 0, 0, .35);
            }

            .info .item .text {
                color: rgba(0, 0, 0, .85);
                margin-bottom: 4px;
                font-size: 15px;
            }

            .info .divider {
                border-bottom: 1px solid rgba(0, 0, 0, 0.12);
                margin: 16px 0;
            }

            .info .item .subtext {
                color: rgba(0, 0, 0, .7);
                font-weight: 400;
            }

            .mobile {
                display: none;
            }

            @media screen and (max-width: 960px) {
                paper-icon-button {
                    display: none;
                }
                .event .cover {
                    height: 250px;
                }
                .event .cover:before {
                    opacity: .5;
                    height: 72px;
                }
                .event .loading {
                    min-height: 100vh;
                    margin-top: 24px;
                }
                .event .content {
                    -webkit-box-orient: vertical;
                    -webkit-box-direction: normal;
                    -ms-flex-direction: column;
                    flex-direction: column;
                }
                .event .details {
                    padding: 24px 42px 24px 24px;
                    -webkit-box-sizing: border-box;
                    box-sizing: border-box;
                }

                .event .info {
                    margin: 0;
                    min-width: 0;
                }

                .event .info .card {
                    padding: 0 0 24px 0;
                }

                .info .item {
                    padding: 16px 24px;
                }

                .info .divider {
                    margin: 0;
                }

                .info .card .button {
                    margin: 0 24px;

                }
            }
        </style>

        <div class="container">
            <a href="../events/" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
                <paper-icon-button icon="gdg-icons:arrow-back"></paper-icon-button>
            </a>
            <div class="event card">
                <div class="cover" id="cover_pic"></div>
                <template is="dom-if" if="[[!data]]">
                    <template is="dom-if" if="[[!noInternet]]">
                        <div class="loading">
                            <paper-spinner-lite active></paper-spinner-lite>
                        </div>
                    </template>
                    <template is="dom-if" if="[[noInternet]]">
                        <div class="loading">
                            <iron-icon icon="gdg-icons:perm-scan-wifi"></iron-icon>
                            <h2>No internet connection</h2>
                            <p>Check if your device is connected to a mobile network or WiFi.</p>
                        </div>
                    </template>
                </template>
                <template is="dom-if" if="[[data]]">
                    <div class="content">
                        <div class="details">
                            <template is="dom-if" if="[[data]]">
                                <h3>[[data.title]]</h3>
                                <div class="chip-container">
                                    <div class="chip" id$="[[_snakeCase(data.tag)]]">[[data.tag]]</div>
                                </div>
                                <div class="description">
                                    <p>[[data.description]]
                                </div>
                            </template>
                        </div>
                        <div class="info">
                            <div class="card">
                                <template is="dom-if" if="[[data]]">
                                    <div class="item">
                                        <div class="row">
                                            <div class="title">WHEN</div>
                                            <div class="text">[[_parseDate(data.start_time)]]</div>
                                            <div class="subtext">[[_parseTime(data.start_time)]] - [[_parseTime(data.end_time)]]</div>
                                        </div>
                                    </div>
                                    <div class="divider"></div>
                                    <div class="item">
                                        <div class="row">
                                            <div class="title">WHERE</div>
                                            <div class="text">[[data.venue_name]]</div>
                                            <div class="subtext">[[data.venue_address]]</div>
                                        </div>
                                    </div>
                                    <template is="dom-if" if="[[data.url]]">
                                        <a target="_blank" href$="[[data.url]]" class="button">Visit Website</a>
                                    </template>
                                </template>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </div>
    </template>

    <script>
        class GdgEventsDetails extends Polymer.GestureEventListeners(Polymer.Element) {
            static get is() { return 'gdg-events-details'; }

            loadData(page) {
                this.$.cover_pic.style.backgroundImage = '';
                this.set('data', false);
                this.set('noInternet', false);
                firebase.firestore().collection('events').doc(page).get().then((doc) => {
                    if (doc.exists) {
                        if (doc.data().photoUrl) {
                            this.$.cover_pic.style.backgroundImage = 'url(' + doc.data().photoUrl + ')'
                        }
                        else {
                            this.$.cover_pic.style.backgroundImage = 'url(' + this.rootPath + 'images/gdgkl.jpg)';
                        }
                        this.set('data', doc.data());
                        document.title = doc.data().title + ' - GDG Kuala Lumpur';
                    }
                    else {
                        this.dispatchEvent(new CustomEvent('showToast', { detail: { text: 'Event not found. Please try again.' } }));
                        window.history.pushState({}, null, '/events/');
                        window.dispatchEvent(new CustomEvent('location-changed'));
                    }
                }).catch(error => {
                    if (error.code == 'aborted') {
                        this.set('noInternet', true);
                        this.$.cover_pic.style.backgroundImage = 'url(' + this.rootPath + 'images/gdgkl.jpg)';
                    }
                    else {
                        this.dispatchEvent(new CustomEvent('showToast', { detail: { text: 'Event not found. Please try again.' } }));
                        window.history.pushState({}, null, '/events/');
                        window.dispatchEvent(new CustomEvent('location-changed'));
                    }
                })
            }

            _snakeCase(tag) {
                return tag.replace(/\s+/g, '_').toLowerCase();
            }

            _parseTime(time) {
                if (time) {
                    return new Date(time).toLocaleString('en-US', { hour: 'numeric', minute: 'numeric', hour12: true });
                }
                else {
                    return ""
                }
            }

            _parseDate(date) {
                if (date) {
                    return new Date(date).toLocaleString("en-us", { day: "numeric", month: "short", year: "numeric" });
                }
                else {
                    return ""
                }
            }
        }

        window.customElements.define(GdgEventsDetails.is, GdgEventsDetails);
    </script>
</dom-module>