<html><head><link rel="import" href="common-worker.html">
<script>!function(){"use strict";var t="__workerUrl",e="__connectsToWorker",n="__connected",r="__messageId",s="__mirroringSupported";Polymer.AppIndexedDBMirrorClient=function(i){this[t]=i,this[n]=!1,this[r]=0,this[e]=null,this[s]=null,this.connect()},Polymer.AppIndexedDBMirrorClient.prototype={get supportsMirroring(){return this[s]},validateSession:function(t){return this.post({type:"app-mirror-validate-session",session:t})},post:function(t){return this.connect().then(function(e){return this[s]?new Promise(function(n){var s=this[r]++,i=e.port;i.addEventListener("message",function o(t){t.data&&t.data.id===s&&(i.removeEventListener("message",o),n(t.data.result))}),t.id=s,i.postMessage(t)}.bind(this)):Promise.resolve({})}.bind(this))},transaction:function(t,e,n){return this.post({type:"app-mirror-transaction",method:t,key:e,value:n})},closeDb:function(){return this.post({type:"app-mirror-close-db"})},connect:function(){return this[n]||this[e]?this[e]:this[e]=new Promise(function(e){var r=new Polymer.CommonWorker(this[t]);r.port.addEventListener("message",function(t){t.data&&"app-mirror-connected"===t.data.type&&(this[n]=!0,this[s]=t.data.supportsIndexedDB,e(r))}.bind(this)),r.addEventListener("error",function(t){console.error(t.message||t)}),r.port.start(),r.port.postMessage({type:"app-mirror-connect"})}.bind(this))}}}();</script>
</head><body></body></html>